<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Battleship</title>

	<!-- CSS -->
	<link href="https://fonts.googleapis.com/css?family=Russo+One" rel="stylesheet">
	<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="vendor/animate.css">
	<link rel="stylesheet" href="stylesheets/main.css">

	<!-- JavaScript -->
	<script src="javascripts/ext/underscore.js"></script>
	<script src="vendor/jquery-1.11.3.min.js"></script>
	<script src="javascripts/ext/jshashtable-2.1.js"></script>
	<script src="javascripts/ext/jquery.numeric.js"></script>
	<script src="javascripts/ext/jquery.numberformatter.js"></script>
	<script src="javascripts/ext/backbone.js"></script>
	<script src="javascripts/ext/icanhaz.js"></script>
	<script src="javascripts/ext/zingchart.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="javascripts/app/Boat.js"></script>
	<script src="javascripts/app/Cell.js"></script>
	<script src="javascripts/app/Board.js"></script>
	<script src="javascripts/app/Game.js"></script>
	<script src="javascripts/app/Chart.js"></script>
	<script src="javascripts/app/Fleet.js"></script>
    <script src="javascripts/app/StatusPanel.js"></script>
	<script src="javascripts/boot.js"></script>

	<script id="board" type="text/html">
		<td>{{ name }}</td>
	</script>

	<!-- Include the StatusPanel class definition here -->
	<script src="javascripts/app/StatusPanel.js"></script>

	<script>
		// Parse URL parameters
		const urlParams = new URLSearchParams(window.location.search);
		const simulation = urlParams.get('simulation');
		const fixedFleet = urlParams.get('fixedfleet') === 'true';
		const grayscale = urlParams.get('grayscale') === 'true';
		
		let gameTitle;
		let shotsPerIteration;
		let inputVisibility = 'visible';
		
		switch(simulation) {
			case 'agile':
				gameTitle = 'Battleship - Batalla Naval Ágil';
				shotsPerIteration = 1;
				inputVisibility = 'hidden';
				break;
			case 'waterfall':
				gameTitle = 'Battleship - Batalla Naval Cascada';
				shotsPerIteration = 40;
				inputVisibility = 'hidden';
				break;
			default:
				gameTitle = 'Battleship - Batalla Naval';
				shotsPerIteration = 40;
		}
		
		document.addEventListener('DOMContentLoaded', function() {
			// Set the game title
			document.querySelector('.navbar-brand').textContent = gameTitle;
		
			// Set shots per iteration and visibility
			const shotsInput = document.getElementById('shotsPerIteration');
			const shotsLabel = document.querySelector("label[for='shotsPerIteration']");
			shotsInput.value = shotsPerIteration;
			shotsInput.style.visibility = inputVisibility;
			shotsLabel.style.visibility = inputVisibility;
		
			// If simulation mode, start game automatically
			if (simulation === 'agile' || simulation === 'waterfall') {
				document.getElementById('newGame').click();
			}

		});
		
		// Pass the 'fixedFleet' variable to the global window object
		// If is true, the game will be use a fixed fleet in the board defined in boot.js
		window.fixedFleet = fixedFleet;

		// The $(document).ready() function ensures the code inside it runs after the entire HTML document has loaded.
		$(document).ready(function() {
			// If the grayscale parameter is present, show the toggle button.
			// Otherwise, hide it.
			if (urlParams.has('grayscale')) {
			$('#toggleColorMode').show();
			} else {
			$('#toggleColorMode').hide();
			}
			// If the grayscale parameter is true, add the "grayscale" class to the body element.
			if (grayscale) {
				$('body').addClass('grayscale');
			}
			// This is the JavaScript code that toggles grayscale mode.
			$('#toggleColorMode').click(function() {
				$('body').toggleClass('grayscale');
			});

            var totalShotsPanel = new StatusPanel({
                panelClass: 'panel-info',
                iconSrc: 'images/missile.svg',
                spanId: 'totalShotsRemaining',
                description: 'Total de disparos restantes'
            });
            $(".stats").append(totalShotsPanel.render().$el);

            var shotsRemainingPanel = new StatusPanel({
                panelClass: 'panel-warning',
                iconSrc: 'images/cycle.svg',
                spanId: 'shotsRemainingForIteration',
                description: 'Disparos restantes en la iteración'
            });
            $(".stats").append(shotsRemainingPanel.render().$el);

            var fundsPanel = new StatusPanel({
                panelClass: 'panel-success',
                iconSrc: 'images/profit.svg',
                spanId: 'funds',
                description: 'Balance restante'
            });
            $(".stats").append(fundsPanel.render().$el);
            // Create the div for the chart and add it to the stats div
            var chartDiv = $('<div>').addClass('col-xs-12').append($('<div>').addClass('row').attr('id', 'chartDiv'));
            $(".stats").append(chartDiv);
                    
		});
	</script>
	
</head>

<body>
    <body>
        <div class="container">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand logo-text" href="#">Battleship - Batalla Naval</a>
                    </div>
                    <div class="navbar-form navbar-right" role="initGame">
                        <label for="shotsPerIteration">Disparos por iteración:</label>
                        <div class="input-group">
                            <input type="number" min="1" max="40" value="40" id="shotsPerIteration" class="form-control">
                            <span class="input-group-btn">
                                <button class="btn btn-primary" type="button" id="newGame">Empezar un juego nuevo</button>
                            </span>
                        </div>
                        <div class="grayscale-group">
                            <button id="toggleColorMode" class="btn btn-primary" type="button">Toggle Color Mode</button>
                        </div>
                    </div>
                </div>
            </nav>
    
            <span id="endGameResult"></span>
    
            <div class="row message">
                <div class="col-xs-12 text-center">
					<img src="images/war-ship.svg" width="200">
                    <h2>Bienvenido</h2>
                    <p class="lead">Inicia un nuevo juego seleccionando el número de disparos por iteración</p>
                </div>
            </div>
    
            <div class="row vertical-align">
                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                    <div class="row stats animated fadeInRight hidden">
                    </div>
                </div>
                <div class="col-xs-12 col-sm-8 col-md-8 col-lg-6 text-center">
                    <div id="boardcontainer"></div>
                </div>
    
            </div>
        </div>
    
        <footer class="text-center">
            <p>Versión mejorada por <a href="http://www.leansight.com"><img src="images/leansight.svg" width="150" alt="leansight"></a></p>
            <p>Desarrollo bootstrap por <a href="https://github.com/MatiMenich" target="_blank">Mati Menich</a></p>
            <p>Derivado de <a href="https://github.com/zilverline/battleship" target="_blank">Battleship</a> por Zilverline / Daniël van Hoesel, Bob Forma, Mark Suurmond.</p>
        </footer>
    </body>
    
</body>

</html>
